# 1. Cleaning DHS Data and preparing variables to compute a wealth index
rm(list = ls())
# Libraries
library(readstata13)
library(data.table)
library(readxl)
library(writexl)
library(tidyverse)
# Path
Paths <- c("/Users/juliagirard/Dropbox/LMMA_Madagascar/2.Data/DHS/")
names(Paths) <- c("juliagirard")
setwd(Paths[Sys.info()[["user"]]])
codebook_sheets <- "codebook_dhs_wealthindex_mada.xlsx"
codebook_sheets %>%
excel_sheets()
### DHS 1997
# load data
codebook <- read_excel("codebook_dhs_wealthindex_mada.xlsx",1) # first sheet is 1997
colnames(codebook) = codebook[1,] # top line is col. names
codebook <- codebook[-1,] # drop 1st line (repetition of colnames)
dhs <- data.frame(read.dta13("raw_data/Madagascar/1997/MDHR31FL.DTA", convert.factors = F))
# retrieve numeric codes for recoding the 3 qualitative variables: floor type, toilet type and drinking water source type
dhs <- merge(dhs, codebook[,c(1,3)], by.x = "hv205", by.y = "dhs_code_toilet", all.x = T, all.y = F)
dhs <- merge(dhs, codebook[,c(4,6)], by.x = "hv201", by.y = "dhs_code_water", all.x = T, all.y = F)
dhs <- merge(dhs, codebook[,c(7,9)], by.x = "hv213", by.y = "dhs_code_floor", all.x = T, all.y = F)
# putting names, and keep just the required variables
setnames(dhs, "hv002", "hh_nb")
setnames(dhs, "hv001", "cluster_nb")
setnames(dhs, "hv005", "sample_weight")
setnames(dhs, "hv007", "year")
setnames(dhs, "hv025", "urban_rural") # 1 is urban 2 is rural
setnames(dhs, "hv206", "electricity")
setnames(dhs, "hv207", "radio")
setnames(dhs, "hv208", "tv")
setnames(dhs, "hv209", "fridge")
setnames(dhs, "hv211", "motorcycle")
setnames(dhs, "hv212", "car_truck")
setnames(dhs, "hv221", "telephone")
dhs$rooms_per_person <- dhs$hv216/dhs$hv009
dhs$rooms_per_person <- replace(dhs$rooms_per_person, dhs$hv216==99, NA)
dhs <- dhs[,(names(dhs) %in% c("hhid", "hh_nb", "cluster_nb", "sample_weight", "year", "urban_rural", "rooms_per_person", "electricity", "radio", "tv", "fridge", "motorcycle", "car_truck", "telephone", "recode_water", "recode_toilet", "recode_floor"))]
dhs$recode_floor <- as.numeric(dhs$recode_floor)
dhs$recode_water <- as.numeric(dhs$recode_water)
dhs$recode_toilet <- as.numeric(dhs$recode_toilet)
dhs$urban_rural <- replace(dhs$urban_rural, dhs$urban_rural==1, "urban")
dhs$urban_rural <- replace(dhs$urban_rural, dhs$urban_rural==2, "rural")
dhs[dhs==9]=NA
dhs[dhs==99]=NA
# imputation for replacing missing values before PCA
# Merge with GPS coordinates
# saving
write_xlsx(dhs,"mada_dhs_97_assets_cleaned.xlsx")
rm(codebook, dhs)
### DHS 2008-2009
# load data
codebook <- read_excel("codebook_dhs_wealthindex_mada.xlsx",2) # 2nd sheet is 2008-2009
colnames(codebook) = codebook[1,] # top line is col. names
codebook <- codebook[-1,] # drop 1st line (repetition of colnames)
dhs <- data.frame(read.dta13("raw_data/Madagascar/2008_09/MDHR51FL.DTA", convert.factors = F))
# retrieve numeric codes for recoding the 3 qualitative variables: floor type, toilet type and drinking water source type
dhs <- merge(dhs, codebook[,c(1,3)], by.x = "hv205", by.y = "dhs_code_toilet", all.x = T, all.y = F)
dhs <- merge(dhs, codebook[,c(4,6)], by.x = "hv201", by.y = "dhs_code_water", all.x = T, all.y = F)
dhs <- merge(dhs, codebook[,c(7,9)], by.x = "hv213", by.y = "dhs_code_floor", all.x = T, all.y = F)
# putting names, and keep just the required variables
setnames(dhs, "hv002", "hh_nb")
setnames(dhs, "hv001", "cluster_nb")
setnames(dhs, "hv005", "sample_weight")
setnames(dhs, "hv007", "year")
setnames(dhs, "hv025", "urban_rural") # 1 is urban 2 is rural
setnames(dhs, "hv206", "electricity")
setnames(dhs, "hv207", "radio")
setnames(dhs, "hv208", "tv")
setnames(dhs, "hv209", "fridge")
setnames(dhs, "hv211", "motorcycle")
setnames(dhs, "hv212", "car_truck")
setnames(dhs, "hv221", "telephone")
dhs$rooms_per_person <- dhs$hv216/dhs$hv009
dhs$rooms_per_person <- replace(dhs$rooms_per_person, dhs$hv216==99, NA)
dhs <- dhs[,(names(dhs) %in% c("hhid", "hh_nb", "cluster_nb", "sample_weight", "year", "urban_rural", "rooms_per_person", "electricity", "radio", "tv", "fridge", "motorcycle", "car_truck", "telephone", "recode_water", "recode_toilet", "recode_floor"))]
dhs$recode_floor <- as.numeric(dhs$recode_floor)
dhs$recode_water <- as.numeric(dhs$recode_water)
dhs$recode_toilet <- as.numeric(dhs$recode_toilet)
dhs$urban_rural <- replace(dhs$urban_rural, dhs$urban_rural==1, "urban")
dhs$urban_rural <- replace(dhs$urban_rural, dhs$urban_rural==2, "rural")
dhs[dhs==9]=NA
dhs[dhs==99]=NA
# imputation for replacing missing values before PCA
# Merge with GPS coordinates
# saving
write_xlsx(dhs,"mada_dhs_200809_assets_cleaned.xlsx")
rm(codebook, dhs)
### DHS 2011
# load data
codebook <- read_excel("codebook_dhs_wealthindex_mada.xlsx",3) # 3rd sheet is 2011
colnames(codebook) = codebook[1,] # top line is col. names
codebook <- codebook[-1,] # drop 1st line (repetition of colnames)
dhs <- data.frame(read.dta13("raw_data/Madagascar/2011/MDHR61FL.DTA", convert.factors = F))
# retrieve numeric codes for recoding the 3 qualitative variables: floor type, toilet type and drinking water source type
dhs <- merge(dhs, codebook[,c(1,3)], by.x = "hv205", by.y = "dhs_code_toilet", all.x = T, all.y = F)
dhs <- merge(dhs, codebook[,c(4,6)], by.x = "hv201", by.y = "dhs_code_water", all.x = T, all.y = F)
dhs <- merge(dhs, codebook[,c(7,9)], by.x = "hv213", by.y = "dhs_code_floor", all.x = T, all.y = F)
# putting names, and keep just the required variables
setnames(dhs, "hv002", "hh_nb")
setnames(dhs, "hv001", "cluster_nb")
setnames(dhs, "hv005", "sample_weight")
setnames(dhs, "hv007", "year")
setnames(dhs, "hv025", "urban_rural") # 1 is urban 2 is rural
setnames(dhs, "hv206", "electricity")
setnames(dhs, "hv207", "radio")
setnames(dhs, "hv208", "tv")
setnames(dhs, "hv209", "fridge")
setnames(dhs, "hv211", "motorcycle")
setnames(dhs, "hv212", "car_truck")
setnames(dhs, "hv221", "telephone")
dhs$rooms_per_person <- dhs$hv216/dhs$hv009
dhs$rooms_per_person <- replace(dhs$rooms_per_person, dhs$hv216==99, NA)
dhs <- dhs[,(names(dhs) %in% c("hhid", "hh_nb", "cluster_nb", "sample_weight", "year", "urban_rural", "rooms_per_person", "electricity", "radio", "tv", "fridge", "motorcycle", "car_truck", "telephone", "recode_water", "recode_toilet", "recode_floor"))]
dhs$recode_floor <- as.numeric(dhs$recode_floor)
dhs$recode_water <- as.numeric(dhs$recode_water)
dhs$recode_toilet <- as.numeric(dhs$recode_toilet)
dhs$urban_rural <- replace(dhs$urban_rural, dhs$urban_rural==1, "urban")
dhs$urban_rural <- replace(dhs$urban_rural, dhs$urban_rural==2, "rural")
dhs[dhs==9]=NA
dhs[dhs==99]=NA
# imputation for replacing missing values before PCA
# Merge with GPS coordinates
# saving
write_xlsx(dhs,"mada_dhs_2011_assets_cleaned.xlsx")
rm(codebook, dhs)
### DHS 2013
# load data
codebook <- read_excel("codebook_dhs_wealthindex_mada.xlsx",4) # 4th sheet is 2013
colnames(codebook) = codebook[1,] # top line is col. names
codebook <- codebook[-1,] # drop 1st line (repetition of colnames)
dhs <- data.frame(read.dta13("raw_data/Madagascar/2013/MDHR6AFL.DTA", convert.factors = F))
# retrieve numeric codes for recoding the 3 qualitative variables: floor type, toilet type and drinking water source type
dhs <- merge(dhs, codebook[,c(1,3)], by.x = "hv205", by.y = "dhs_code_toilet", all.x = T, all.y = F)
dhs <- merge(dhs, codebook[,c(4,6)], by.x = "hv201", by.y = "dhs_code_water", all.x = T, all.y = F)
dhs <- merge(dhs, codebook[,c(7,9)], by.x = "hv213", by.y = "dhs_code_floor", all.x = T, all.y = F)
# putting names, and keep just the required variables
setnames(dhs, "hv002", "hh_nb")
setnames(dhs, "hv001", "cluster_nb")
setnames(dhs, "hv005", "sample_weight")
setnames(dhs, "hv007", "year")
setnames(dhs, "hv025", "urban_rural") # 1 is urban 2 is rural
setnames(dhs, "hv206", "electricity")
setnames(dhs, "hv207", "radio")
setnames(dhs, "hv208", "tv")
setnames(dhs, "hv209", "fridge")
setnames(dhs, "hv211", "motorcycle")
setnames(dhs, "hv212", "car_truck")
setnames(dhs, "hv221", "telephone")
dhs$rooms_per_person <- dhs$hv216/dhs$hv009
dhs$rooms_per_person <- replace(dhs$rooms_per_person, dhs$hv216==99, NA)
dhs <- dhs[,(names(dhs) %in% c("hhid", "hh_nb", "cluster_nb", "sample_weight", "year", "urban_rural", "rooms_per_person", "electricity", "radio", "tv", "fridge", "motorcycle", "car_truck", "telephone", "recode_water", "recode_toilet", "recode_floor"))]
dhs$recode_floor <- as.numeric(dhs$recode_floor)
dhs$recode_water <- as.numeric(dhs$recode_water)
dhs$recode_toilet <- as.numeric(dhs$recode_toilet)
dhs$urban_rural <- replace(dhs$urban_rural, dhs$urban_rural==1, "urban")
dhs$urban_rural <- replace(dhs$urban_rural, dhs$urban_rural==2, "rural")
dhs[dhs==9]=NA
dhs[dhs==99]=NA
# imputation for replacing missing values before PCA
# Merge with GPS coordinates
# saving
write_xlsx(dhs,"mada_dhs_2013_assets_cleaned.xlsx")
rm(codebook, dhs)
### DHS 2016
# load data
codebook <- read_excel("codebook_dhs_wealthindex_mada.xlsx",5) # 5th sheet is 2016
colnames(codebook) = codebook[1,] # top line is col. names
codebook <- codebook[-1,] # drop 1st line (repetition of colnames)
dhs <- data.frame(read.dta13("raw_data/Madagascar/2016/MDHR71FL.DTA", convert.factors = F))
# retrieve numeric codes for recoding the 3 qualitative variables: floor type, toilet type and drinking water source type
dhs <- merge(dhs, codebook[,c(1,3)], by.x = "hv205", by.y = "dhs_code_toilet", all.x = T, all.y = F)
dhs <- merge(dhs, codebook[,c(4,6)], by.x = "hv201", by.y = "dhs_code_water", all.x = T, all.y = F)
dhs <- merge(dhs, codebook[,c(7,9)], by.x = "hv213", by.y = "dhs_code_floor", all.x = T, all.y = F)
# putting names, and keep just the required variables
setnames(dhs, "hv002", "hh_nb")
setnames(dhs, "hv001", "cluster_nb")
setnames(dhs, "hv005", "sample_weight")
setnames(dhs, "hv007", "year")
setnames(dhs, "hv025", "urban_rural") # 1 is urban 2 is rural
setnames(dhs, "hv206", "electricity")
setnames(dhs, "hv207", "radio")
setnames(dhs, "hv208", "tv")
setnames(dhs, "hv209", "fridge")
setnames(dhs, "hv211", "motorcycle")
setnames(dhs, "hv212", "car_truck")
setnames(dhs, "hv221", "telephone")
dhs$rooms_per_person <- dhs$hv216/dhs$hv009
dhs$rooms_per_person <- replace(dhs$rooms_per_person, dhs$hv216==99, NA)
dhs <- dhs[,(names(dhs) %in% c("hhid", "hh_nb", "cluster_nb", "sample_weight", "year", "urban_rural", "rooms_per_person", "electricity", "radio", "tv", "fridge", "motorcycle", "car_truck", "telephone", "recode_water", "recode_toilet", "recode_floor"))]
dhs$recode_floor <- as.numeric(dhs$recode_floor)
dhs$recode_water <- as.numeric(dhs$recode_water)
dhs$recode_toilet <- as.numeric(dhs$recode_toilet)
dhs$urban_rural <- replace(dhs$urban_rural, dhs$urban_rural==1, "urban")
dhs$urban_rural <- replace(dhs$urban_rural, dhs$urban_rural==2, "rural")
dhs[dhs==9]=NA
dhs[dhs==99]=NA
# imputation for replacing missing values before PCA
# Merge with GPS coordinates
# saving
write_xlsx(dhs,"mada_dhs_2016_assets_cleaned.xlsx")
rm(codebook, dhs)
# 1b. Cleaning MICS Data and preparing variables to compute a wealth index
rm(list = ls())
# Libraries
library(haven)
library(readstata13)
library(data.table)
library(readxl)
library(writexl)
library(tidyverse)
# Path
Paths <- c("/Users/juliagirard/Dropbox/LMMA_Madagascar/2.Data/mics/")
names(Paths) <- c("juliagirard")
setwd(Paths[Sys.info()[["user"]]])
# Load data and keep only the variables needed and those who responded (gave consent)
df <- read_sav("2018/datasets_spss/hh.sav")
# df <- df[, c(1,2,8,9,16,33,35,53,54,57,58,63,64,65,70,71,73,79,240,241,259,263,264,265,321,325,326,327,328,329,330,331,332,333,334,335)]
df <- df[df$HH12==1,] # keep only those who agreed to participate (consent)
# recoding variables
df$cluster_nb <- df$HH1 # numéro de grappe - pour matcher avec gps
df$hh_nb <- df$HH2
df$year <- 2018
df$urban_rural <- ifelse(df$HH6==1, "urban", ifelse(df$HH6==2, "rural", NA))
df$rooms_per_person <- df$HC3 / df$HH48 # outliers
df$telephone <- ifelse(df$HC7A==1, 1,
ifelse(df$HC7A==2, 0, NA))
df$radio <- ifelse(df$HC7B==1, 1,
ifelse(df$HC7B==2, 0, NA))
df$electricity <- ifelse(df$HC8==1 | df$HC8==2, 1,
ifelse(df$HC8==3, 0, NA))
df$tv <- ifelse(df$HC9A==1, 1,
ifelse(df$HC9A==2, 0, NA))
df$fridge <- ifelse(df$HC9B==1, 1,
ifelse(df$HC9B==2,0,NA))
df$motorcycle <- ifelse(df$HC10C==1, 1,
ifelse(df$HC10C==2, 0, NA))
df$car_truck <- ifelse(df$HC10E==1, 1,
ifelse(df$HC10E==2, 0, NA))
df$recode_floor <- ifelse(df$HC4==96 | df$HC4==99, NA, df$HC4)
df$recode_floor <- ifelse(df$HC4 < 30, 0,
ifelse(df$HC4 >=30, 1, df$HC4))
df$recode_water <- ifelse(df$WS1==96 | df$WS1==99, NA, df$WS1)
df$recode_water <- ifelse(df$WS1 <=31 | df$WS1 == 41 | df$WS1 == 51 | df$WS1 == 61 | df$WS1 == 71 | df$WS1 == 91 | df$WS1 == 92, 1,
ifelse(df$WS1 == 81 | df$WS1 == 42 | df$WS1 == 32, 0, NA))
df$recode_toilet <- ifelse(df$WS11==96 | df$WS11==99, NA, df$WS11)
df$recode_toilet <- ifelse(df$WS11 <= 22 | df$WS11==24 | df$WS11==31 , 1,
ifelse(df$WS11==23 | df$WS11==51 | df$WS11==95 | df$WS11==41, 4, NA))
# keep only relevant variables
df <- df[,(names(df) %in% c("hh_nb", "cluster_nb", "hhweight", "year", "urban_rural", "rooms_per_person", "electricity", "radio", "tv", "fridge", "motorcycle", "car_truck", "telephone", "recode_water", "recode_toilet", "recode_floor"))]
# replacing missing values before PCA
df$tv <- replace(df$tv, is.na(df$tv)==T & df$electricity==0, 0)
df$fridge <- replace(df$fridge, is.na(df$fridge)==T & df$electricity==0, 0)
# saving
write_xlsx(df,"mada_mics_2018_assets_cleaned.xlsx")
